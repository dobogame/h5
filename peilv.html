<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1 user-scalable=no">
	<title>bootstrap</title>
	<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
	<script src="jquery.min.js"></script>
	<!-- 新 Bootstrap5 核心 CSS 文件 -->
	<link rel="stylesheet" href="bootstrap.min.css">
	<!-- 引入图标库icon -->
	<link rel="stylesheet" href="icon/bootstrap-icons.css">
	<!-- 最新的 Bootstrap5 核心 JavaScript 文件 -->
	<script src="bootstrap.bundle.min.js"></script>
	<!-- css解决a链接按钮式显示蓝框 -->
	<link rel="stylesheet" href="my.css">
</head>
<body>
	<!-- 自适应导航 -->
	<main id="app">
		<!-- 导航 -->
		<div class="container bg-secondary p-0 sticky-top">
			<div class="d-flex justify-content-between">
				<a href="home.html" class="link-light shadow p-3 text-decoration-none">幸运五星彩</a>
				<a href="kuaida.html" class="link-light px-2 py-3 text-decoration-none">快打</a>
				<a href="kuaixuan.html" class="link-light px-2 py-3 text-decoration-none">快选</a>
				<a href="mingxi.html" class="link-light px-2 py-3 text-decoration-none">明细</a>
				<a href="zhangdan.html" class="link-light px-2 py-3 text-decoration-none">账单</a>
				<a href="#admin" class="link-light p-3 shadow-sm text-decoration-none" data-bs-toggle="offcanvas" aria-controls="admin"><i class="bi bi-person-circle" style="font-size: 1rem;"></i></a>
			</div>
		</div>
		<!-- 个人中心侧边栏 -->
		<div class="offcanvas offcanvas-end w-75" tabindex="-1" id="admin" aria-labelledby="adminLabel" data-bs-scroll="false" data-bs-backdrop="true">
		  <div class="offcanvas-header bg-secondary">
		  	<div id="offcanvasTopLabel">
		  		<p class="text-light">账户:{{account}}</p>
		  		<div><small class="text-dark">可用余额:{{(usable / 100).toFixed(2)}}</small></div>
		  		<div><small class="text-dark">账户额度:{{(credit / 100).toFixed(2)}}</small></div>
		  		<div><small class="text-warning">账户余额:{{((usable - credit) / 100).toFixed(2)}}</small></div>	
		  	</div>
		    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
		  </div>
		  <div class="offcanvas-body">
		  	<a href="kaijiang.html" class="d-flex align-items-center text-dark text-decoration-none">
		  		<span><i class="bi bi-cc-square-fill me-2 text-secondary" style="font-size:2rem;"></i></span>
		  		<span>开奖号码</span>
		  	</a>
		  	<a href="guize.html" class="d-flex align-items-center text-dark text-decoration-none">
		  		<span><i class="bi bi-clipboard-data-fill me-2 text-secondary" style="font-size:2rem;"></i></span>
		  		<span>规则说明</span>
		  	</a>	  	
		  	<a href="peilv.html" class="d-flex align-items-center text-dark text-decoration-none">
		  		<span><i class="bi bi-back me-2 text-secondary" style="font-size:2rem;"></i></span>
		  		<span>赔率转换</span>
		  	</a>
		  	<a href="zhuce.html" class="d-flex align-items-center text-dark text-decoration-none mb-3">
		  		<span><i class="bi bi-cc-square-fill me-2 text-secondary" style="font-size:2rem;"></i></span>
		  		<span>修改密码</span>
		  	</a>
		  	<div class="d-grid">
		  	    <button type="button" class="btn btn-secondary btn-block">登出</button>
		  	</div>
		  </div>
		</div>
		<!-- .............. -->
		<div class="container px-3 mt-3">
			    <div class="table-responsive">
				    <table class="table table-bordered text-center">
				        <thead>
				          <tr class="text-center">
				            <th></th>
				            <th>交易回水</th>
				            <th>赔率</th>
				          </tr>
				        </thead>
				        <tbody>
				          <tr>
				          	<td class="bg-light text-danger">一定位</td>
				            <td>
				            	<select class="form-select form-select-sm"  v-model="OneFixedOp1">
				            	  <option v-for="op1 in data.OneFixed.option1">{{op1}}</option>
				            	</select>
				            </td>
				            <td>
				            	<select class="form-select form-select-sm"  v-model="OneFixedOp2">
				            	  <option v-for="op2 in data.OneFixed.option2">{{op2}}</option>
				            	</select>
				            </td>
				          </tr>

							<tr>
							  <td class="bg-light text-danger">二定位</td>
							  <td>
								  <select class="form-select form-select-sm"  v-model="TwoFixedOp1">
									<option v-for="op1 in data.TwoFixed.option1">{{op1}}</option>
								  </select>
							  </td>
							  <td>
								  <select class="form-select form-select-sm"  v-model="TwoFixedOp2">
									<option v-for="op2 in data.TwoFixed.option2">{{op2}}</option>
								  </select>
							  </td>
							</tr>
						<tr>
						  <td class="bg-light text-danger">五位二定</td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="TwoOutOfFiveOp1">
								<option v-for="op1 in data.TwoOutOfFive.option1">{{op1}}</option>
							  </select>
						  </td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="TwoOutOfFiveOp2">
								<option v-for="op2 in data.TwoOutOfFive.option2">{{op2}}</option>
							  </select>
						  </td>
						</tr>

						<tr>
						<td class="bg-light text-danger">三定位</td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="ThreeFixedOp1">
								<option v-for="op1 in data.ThreeFixed.option1">{{op1}}</option>
							  </select>
						  </td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="ThreeFixedOp2">
								<option v-for="op2 in data.ThreeFixed.option2">{{op2}}</option>
							  </select>
						  </td>
						</tr>

						<tr>
							<td class="bg-light text-danger">四定位</td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="FourFixedOp1">
								<option v-for="op1 in data.FourFixed.option1">{{op1}}</option>
							  </select>
						  </td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="FourFixedOp2">
								<option v-for="op2 in data.FourFixed.option2">{{op2}}</option>
							  </select>
						  </td>
						</tr>

						<tr>
							<td class="bg-light text-danger">二字现</td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="TwoPresentOp1">
								<option v-for="op1 in data.TwoPresent.option1">{{op1}}</option>
							  </select>
						  </td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="TwoPresentOp2">
								<option v-for="op2 in data.TwoPresent.option2">{{op2}}</option>
							  </select>
						  </td>
						</tr>

						<tr>
							<td class="bg-light text-danger">三字现</td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="ThreePresentOp1">
								<option v-for="op1 in data.ThreePresent.option1">{{op1}}</option>
							  </select>
						  </td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="ThreePresentOp2">
								<option v-for="op2 in data.ThreePresent.option2">{{op2}}</option>
							  </select>
						  </td>
						</tr>
						<tr>
							<td class="bg-light text-danger">四字现</td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="FourPresentOp1">
								<option v-for="op1 in data.FourPresent.option1">{{op1}}</option>
							  </select>
						  </td>
						  <td>
							  <select class="form-select form-select-sm"  v-model="FourPresentOp2">
								<option v-for="op2 in data.FourPresent.option2">{{op2}}</option>
							  </select>
						  </td>
						</tr>
				        </tbody>
				    </table>
				    <div class="d-grid">
				        <button type="button" @click="submit" class="btn btn-outline-danger btn-block">确定修改</button>
				    </div>
			    </div>
		</div>
	</main>
<script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.10/vue.min.js"></script>
<script src="https://unpkg.com/vue-resource@1.5.3/dist/vue-resource.min.js"></script>
<script src="https://www.layuicdn.com/layer/layer.js"></script>
<script>

let CASHBACK = {
	OneFixed : [1],
	TwoFixed : [10],
	ThreeFixed : [100],
	FourFixed : [1000],
	TwoPresent : [1, 2],
	ThreePresent : [5, 8, 10],
	FourPresent : [40, 80, 160, 40],
	TwoOutOfFive : [10]
}

const vm = new Vue({
	el : '#app',
	data : {
		url :'',
		usable : 0,
		credit : '',
		account : '',
		data : {
			OneFixed :{},
			TwoFixed : {},
			ThreeFixed : {},
			FourFixed : {},
			TwoPresent : {},
			ThreePresent : {},
			FourPresent : {},
			TwoOutOfFive : {}
		},
		OneFixedOp1 : '',
		OneFixedOp2 : '',
		TwoFixedOp1 : '',
		TwoFixedOp2 : '',
		ThreeFixedOp1 : '',
		ThreeFixedOp2 : '',
		FourFixedOp1 : '',
		FourFixedOp2 : '',
		TwoPresentOp1 : '',
		TwoPresentOp2 : '',
		ThreePresentOp1 : '',
		ThreePresentOp2 : '',
		FourPresentOp1 : '',
		FourPresentOp2 : '',
		TwoOutOfFiveOp1 : '',
		TwoOutOfFiveOp2 : ''
	},
	created : function() {
		this.usable = parseInt(localStorage.getItem('___usable')) || 0		
		this.credit = parseInt(localStorage.getItem('___credit')) || 0			
		this.account = localStorage.getItem('___$account')
		let token = localStorage.getItem('___access-token')
		if (token) {
			Vue.http.headers.common['access-token'] = token
		} else {
			layer.msg('已登出，请重新登录', {time:0, 'btn':['去登陆', '取消'], yes: (index) => {
				location = 'login.html'
			}})
			return
		}
		this.url = localStorage.getItem('___request-url')
		let _this = this
		this.$http.get(this.url + '/lottery/five_star/cashback').then(e => {
			if (e.body.code !== 0) {
				layer.msg(e.body.message)
			}
			Object.keys(e.body.data).forEach(key => {
				e.body.data[key].oddsStr = e.body.data[key].maxOdds.join('/')
				let option1 = []
				let option2 = []
				let index = e.body.data[key].maxCashback
				for (let i = 0; i <= e.body.data[key].maxCashback; i++) {
					let temp = e.body.data[key].maxOdds
					let cb = CASHBACK[key]
					let a = []
					for ( let j = 0; j < temp.length; j++) {
						a[j] = (temp[j] - i * cb[j]) / 100
					}
					option2[index] = a.join('/')
					option1[index] = (i / 1000)
					index--
				}
				e.body.data[key].option1 = option1
				e.body.data[key].option2 = option2
				let op1cashback = e.body.data[key].cashback / 1000
				_this[key+'Op1'] = op1cashback
				let i = option1.indexOf(op1cashback)
				_this[key+'Op2'] = option2[i]
			})
			_this.data = e.body.data
		})
	},
	methods : {
		submit : function() {
			const data = {
				oneFixed : this.OneFixedOp1 * 1000,
				twoFixed : this.TwoFixedOp1 * 1000,
				threeFixed : this.ThreeFixedOp1 * 1000,
				fourFixed : this.FourFixedOp1 * 1000,
				twoPresent : this.TwoPresentOp1 * 1000,
				threePresent : this.ThreePresentOp1 * 1000,
				fourPresent : this.FourPresentOp1 * 1000,
				twoOutOfFive : this.TwoOutOfFiveOp1 * 1000
			}
			const _this = this
			let layerIndex = layer.load()
			this.$http.post(this.url + '/lottery/five_star/cashback/modify', data).then(e => {
				layer.close(layerIndex)
				if (e.body.code !== 0) {
					layer.msg(e.body.message)
					return
				}
				let odds = {}
				e.body.data.forEach(o => {
					odds[o.group] = {way:o.way, group:o.group, odds:(o.odds / 100).toFixed(2), min:(o.minBet / 100).toFixed(2), max:(o.maxBet / 100).toFixed(2)}
				});
				sessionStorage.setItem('___odds', JSON.stringify(odds))
				layer.msg("修改成功")
			}, e => {
				layer.close(layerIndex)
				layer.msg("网络错误,错误码:" + e.status)
			})
		}
	},
	watch : {
		OneFixedOp1 : function(n, v) {
			if (v === '' || v === n) return
			let o1 = this.data.OneFixed.option1.indexOf(parseFloat(n))
			this.OneFixedOp2 = this.data.OneFixed.option2[o1]
		},
		OneFixedOp2 : function(n, v) {
			if (v === '' || v === n) return
			let o2 = this.data.OneFixed.option2.indexOf(n)
			this.OneFixedOp1 = this.data.OneFixed.option1[o2]
		},
		TwoFixedOp1 : function(n, v) {
			if (v === '' || v === n) return
			let o1 = this.data.TwoFixed.option1.indexOf(parseFloat(n))
			this.TwoFixedOp2 = this.data.TwoFixed.option2[o1]
		},
		TwoFixedOp2 : function(n, v) {
			if (v === '' || v === n) return
			let o2 = this.data.TwoFixed.option2.indexOf(n)
			this.TwoFixedOp1 = this.data.TwoFixed.option1[o2]
		},
		ThreeFixedOp1 : function(n, v) {
			if (v === '' || v === n) return
			let o1 = this.data.ThreeFixed.option1.indexOf(parseFloat(n))
			this.ThreeFixedOp2 = this.data.ThreeFixed.option2[o1]
		},
		ThreeFixedOp2 : function(n, v) {
			if (v === '' || v === n) return
			let o2 = this.data.ThreeFixed.option2.indexOf(n)
			this.ThreeFixedOp1 = this.data.ThreeFixed.option1[o2]
		},
		FourFixedOp1 : function(n, v) {
			if (v === '' || v === n) return
			let o1 = this.data.FourFixed.option1.indexOf(parseFloat(n))
			this.FourFixedOp2 = this.data.FourFixed.option2[o1]
		},
		FourFixedOp2 : function(n, v) {
			if (v === '' || v === n) return
			let o2 = this.data.FourFixed.option2.indexOf(n)
			this.FourFixedOp1 = this.data.FourFixed.option1[o2]
		},
		TwoPresentOp1 : function(n, v) {
			if (v === '' || v === n) return
			let o1 = this.data.TwoPresent.option1.indexOf(parseFloat(n))
			this.TwoPresentOp2 = this.data.TwoPresent.option2[o1]
		},
		TwoPresentOp2 : function(n, v) {
			if (v === '' || v === n) return
			let o2 = this.data.TwoPresent.option2.indexOf(n)
			this.TwoPresentOp1 = this.data.TwoPresent.option1[o2]
		},
		ThreePresentOp1 : function(n, v) {
			if (v === '' || v === n) return
			let o1 = this.data.ThreePresent.option1.indexOf(parseFloat(n))
			this.ThreePresentOp2 = this.data.ThreePresent.option2[o1]
		},
		ThreePresentOp2 : function(n, v) {
			if (v === '' || v === n) return
			let o2 = this.data.ThreePresent.option2.indexOf(n)
			this.ThreePresentOp1 = this.data.ThreePresent.option1[o2]
		},
		FourPresentOp1 : function(n, v) {
			if (v === '' || v === n) return
			let o1 = this.data.FourPresent.option1.indexOf(parseFloat(n))
			this.FourPresentOp2 = this.data.FourPresent.option2[o1]
		},
		FourPresentOp2 : function(n, v) {
			if (v === '' || v === n) return
			let o2 = this.data.FourPresent.option2.indexOf(n)
			this.FourPresentOp1 = this.data.FourPresent.option1[o2]
		},
		TwoOutOfFiveOp1 : function(n, v) {
			if (v === '' || v === n) return
			let o1 = this.data.TwoOutOfFive.option1.indexOf(parseFloat(n))
			this.TwoOutOfFiveOp2 = this.data.TwoOutOfFive.option2[o1]
		},
		TwoOutOfFiveOp2 : function(n, v) {
			if (v === '' || v === n) return
			let o2 = this.data.TwoOutOfFive.option2.indexOf(n)
			this.TwoOutOfFiveOp1 = this.data.TwoOutOfFive.option1[o2]
		}
	}
})
</script>
</body>
</html>